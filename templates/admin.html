<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 페이지 - 더하는 교회</title>
    <link rel="stylesheet" href="/static/css/style.css?v=6">
    <link rel="stylesheet" href="/static/css/admin.css?v=6">
</head>

<body>
    <div class="admin-wrapper">
        <!-- Admin Header -->
        <header class="admin-header">
            <div class="container">
                <div class="admin-nav">
                    <h1>✟ 더하는 교회 관리자</h1>
                    <div class="admin-user-info">
                        <span>👤 {{ user.username }}</span>
                        <a href="/logout" class="btn-logout">로그아웃</a>
                        <a href="/" class="btn-home">홈페이지</a>
                    </div>
                </div>
            </div>
        </header>

        <div class="admin-container">
            <div class="container">
                <!-- Church Info Section -->
                <section class="admin-section">
                    <h2 class="section-title">교회 소개 관리</h2>
                    <div class="admin-card">
                        <form method="POST" action="/admin/church-info/update">
                            <div class="form-group">
                                <label for="church-intro">교회 소개 내용</label>
                                <textarea id="church-intro" name="content" rows="5"
                                    required>{{ church_intro }}</textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">저장</button>
                        </form>
                    </div>
                </section>

                <!-- Vision Management Section -->
                <section class="admin-section">
                    <h2 class="section-title">교회비전 관리</h2>

                    <!-- Create Vision Form -->
                    <div class="admin-card">
                        <h3>새 비전 영상 등록</h3>
                        <form method="POST" action="/admin/vision/create">
                            <div class="form-group">
                                <label for="vision-title">영상 제목</label>
                                <input type="text" id="vision-title" name="title" required>
                            </div>
                            <div class="form-group">
                                <label for="youtube-url">YouTube 링크</label>
                                <input type="url" id="youtube-url" name="youtube_url"
                                    placeholder="https://www.youtube.com/watch?v=..." required>
                                <small class="form-hint">YouTube 영상 URL을 입력하세요. 썸네일이 자동으로 추출됩니다.</small>
                            </div>
                            <button type="submit" class="btn btn-primary">비전 등록</button>
                        </form>
                    </div>

                    <!-- Vision List -->
                    <div class="admin-card">
                        <h3>등록된 비전 목록</h3>
                        <div class="vision-list-admin">
                            {% if visions %}
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>번호</th>
                                        <th>제목</th>
                                        <th>작성자</th>
                                        <th>작성일</th>
                                        <th>YouTube ID</th>
                                        <th>관리</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for vision in visions %}
                                    <tr>
                                        <td>{{ vision.id }}</td>
                                        <td>{{ vision.title }}</td>
                                        <td>{{ vision.author }}</td>
                                        <td>{{ vision.date }}</td>
                                        <td><code>{{ vision.youtube_id }}</code></td>
                                        <td>
                                            <form method="POST" action="/admin/vision/delete/{{ vision.id }}"
                                                style="display: inline;">
                                                <button type="submit" class="btn-delete"
                                                    onclick="return confirm('정말 삭제하시겠습니까?')">삭제</button>
                                            </form>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            {% else %}
                            <p class="empty-message">등록된 비전이 없습니다.</p>
                            {% endif %}
                        </div>
                    </div>
                </section>

                <!-- Sermon Management Section -->
                <section class="admin-section">
                    <h2 class="section-title">설교 관리</h2>

                    <!-- Create Sermon Form -->
                    <div class="admin-card">
                        <h3>새 설교 등록</h3>
                        <form method="POST" action="/admin/sermon/create">
                            <div class="form-group">
                                <label for="sermon-title">설교 제목</label>
                                <input type="text" id="sermon-title" name="title" required>
                            </div>
                            <div class="form-group">
                                <label for="pastor">설교자</label>
                                <input type="text" id="pastor" name="pastor" value="김한기 목사" required>
                            </div>
                            <div class="form-group">
                                <label for="sermon-youtube-url">YouTube 링크 (선택)</label>
                                <input type="url" id="sermon-youtube-url" name="youtube_url"
                                    placeholder="https://www.youtube.com/watch?v=...">
                                <small class="form-hint">YouTube 영상 URL을 입력하면 썸네일이 자동으로 표시됩니다. (선택사항)</small>
                            </div>
                            <div class="form-group">
                                <label for="sermon-description">설교 요약</label>
                                <textarea id="sermon-description" name="description" rows="4" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">설교 등록</button>
                        </form>
                    </div>

                    <!-- Sermon List -->
                    <div class="admin-card">
                        <h3>등록된 설교 목록</h3>
                        <div class="sermon-list-admin">
                            {% if sermons %}
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>설교 정보</th>
                                        <th>관리</th>
                                    </tr>
                                </thead>
                                <tbody id="sermon-list">
                                    {% for sermon in sermons %}
                                    <tr class="sermon-row" data-sermon-id="{{ sermon.id }}">
                                        <td class="sermon-display">
                                            <div class="sermon-info">
                                                <strong>{{ sermon.title }}</strong>
                                                <span>{{ sermon.pastor }} | {{ sermon.date }}</span>
                                            </div>
                                            <div class="sermon-description">{{ sermon.description[:100] }}...</div>
                                        </td>
                                        <td>
                                            <button class="btn-edit" onclick="editSermon({{ sermon.id }})">수정</button>
                                            <form method="POST" action="/admin/sermon/delete/{{ sermon.id }}"
                                                style="display: inline;">
                                                <button type="submit" class="btn-delete"
                                                    onclick="return confirm('정말 삭제하시겠습니까?')">삭제</button>
                                            </form>
                                        </td>
                                    </tr>
                                    <tr class="sermon-edit-row" id="edit-{{ sermon.id }}" style="display: none;">
                                        <td colspan="2">
                                            <form method="POST" action="/admin/sermon/update/{{ sermon.id }}"
                                                class="inline-edit-form">
                                                <div class="form-row">
                                                    <input type="text" name="title" value="{{ sermon.title }}"
                                                        placeholder="설교 제목" required>
                                                    <input type="text" name="pastor" value="{{ sermon.pastor }}"
                                                        placeholder="설교자" required>
                                                    <input type="date" name="date" value="{{ sermon.date }}" required>
                                                </div>
                                                <input type="url" name="youtube_url"
                                                    value="{{ sermon.youtube_url or '' }}"
                                                    placeholder="YouTube 링크 (선택)">
                                                <textarea name="description" rows="4" required
                                                    placeholder="설교 요약">{{ sermon.description }}</textarea>
                                                <div class="form-actions">
                                                    <button type="submit" class="btn btn-primary">저장</button>
                                                    <button type="button" class="btn btn-secondary"
                                                        onclick="cancelEdit({{ sermon.id }})">취소</button>
                                                </div>
                                            </form>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            {% else %}
                            <p class="empty-message">등록된 설교가 없습니다.</p>
                            {% endif %}
                        </div>
                    </div>
                </section>

                <!-- YouTube Shorts Management Section -->
                <section class="admin-section">
                    <h2 class="section-title">더하는교회 숏츠 관리</h2>

                    <!-- Create Shorts Form -->
                    <div class="admin-card">
                        <h3>새 숏츠 등록</h3>
                        <form method="POST" action="/admin/shorts/create">
                            <div class="form-group">
                                <label for="shorts-title">숏츠 제목</label>
                                <input type="text" id="shorts-title" name="title" required>
                            </div>
                            <div class="form-group">
                                <label for="shorts-youtube-url">YouTube Shorts 링크</label>
                                <input type="url" id="shorts-youtube-url" name="youtube_url"
                                    placeholder="https://www.youtube.com/shorts/..." required>
                                <small class="form-hint">YouTube Shorts URL을 입력하세요. 썸네일이 자동으로 추출됩니다.</small>
                            </div>
                            <button type="submit" class="btn btn-primary">숏츠 등록</button>
                        </form>
                    </div>

                    <!-- Shorts List -->
                    <div class="admin-card">
                        <h3>숏츠 목록</h3>
                        {% if shorts %}
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>제목</th>
                                    <th>등록일</th>
                                    <th>관리</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for short in shorts %}
                                <tr class="shorts-row" data-shorts-id="{{ short.id }}">
                                    <td>{{ short.title }}</td>
                                    <td>{{ short.date }}</td>
                                    <td>
                                        <button class="btn-edit" onclick="editShorts({{ short.id }})">수정</button>
                                        <form method="POST" action="/admin/shorts/delete/{{ short.id }}"
                                            style="display: inline;">
                                            <button type="submit" class="btn-delete"
                                                onclick="return confirm('정말 삭제하시겠습니까?')">삭제</button>
                                        </form>
                                    </td>
                                </tr>
                                <tr class="shorts-edit-row" id="shorts-edit-{{ short.id }}" style="display: none;">
                                    <td colspan="3">
                                        <form method="POST" action="/admin/shorts/update/{{ short.id }}"
                                            class="inline-edit-form">
                                            <div class="form-row">
                                                <input type="text" name="title" value="{{ short.title }}"
                                                    placeholder="제목" required>
                                                <input type="date" name="date" value="{{ short.date }}" required>
                                            </div>
                                            <input type="url" name="youtube_url" value="{{ short.youtube_url }}"
                                                placeholder="YouTube URL" required
                                                style="width:100%;margin-bottom:10px;">
                                            <div class="form-actions">
                                                <button type="submit" class="btn btn-primary">저장</button>
                                                <button type="button" class="btn btn-secondary"
                                                    onclick="cancelEditShorts({{ short.id }})">취소</button>
                                            </div>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <p class="empty-message">등록된 숏츠가 없습니다.</p>
                        {% endif %}
                    </div>
                </section>

                <!-- 오늘의 QT Management Section -->
                <section class="admin-section">
                    <h2 class="section-title">오늘의 QT 관리</h2>

                    <!-- Create QT Form -->
                    <div class="admin-card">
                        <h3>새 QT 등록</h3>
                        <form method="POST" action="/admin/qty/create">
                            <div class="form-group">
                                <label for="qty-title">QT 제목</label>
                                <input type="text" id="qty-title" name="title" required>
                            </div>
                            <div class="form-group">
                                <label for="qty-youtube-url">YouTube 링크</label>
                                <input type="url" id="qty-youtube-url" name="youtube_url"
                                    placeholder="https://www.youtube.com/watch?v=..." required>
                                <small class="form-hint">YouTube URL을 입력하세요. 썸네일이 자동으로 추출됩니다.</small>
                            </div>
                            <button type="submit" class="btn btn-primary">QT 등록</button>
                        </form>
                    </div>

                    <!-- QT List -->
                    <div class="admin-card">
                        <h3>QT 목록</h3>
                        {% if qtys %}
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>제목</th>
                                    <th>등록일</th>
                                    <th>관리</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for qty in qtys %}
                                <tr class="qty-row" data-qty-id="{{ qty.id }}">
                                    <td>{{ qty.title }}</td>
                                    <td>{{ qty.date }}</td>
                                    <td>
                                        <button class="btn-edit" onclick="editQty({{ qty.id }})">수정</button>
                                        <form method="POST" action="/admin/qty/delete/{{ qty.id }}"
                                            style="display: inline;">
                                            <button type="submit" class="btn-delete"
                                                onclick="return confirm('정말 삭제하시겠습니까?')">삭제</button>
                                        </form>
                                    </td>
                                </tr>
                                <tr class="qty-edit-row" id="qty-edit-{{ qty.id }}" style="display: none;">
                                    <td colspan="3">
                                        <form method="POST" action="/admin/qty/update/{{ qty.id }}"
                                            class="inline-edit-form">
                                            <div class="form-row">
                                                <input type="text" name="title" value="{{ qty.title }}" placeholder="제목"
                                                    required>
                                                <input type="date" name="date" value="{{ qty.date }}" required>
                                            </div>
                                            <input type="url" name="youtube_url" value="{{ qty.youtube_url }}"
                                                placeholder="YouTube URL" required
                                                style="width:100%;margin-bottom:10px;">
                                            <div class="form-actions">
                                                <button type="submit" class="btn btn-primary">저장</button>
                                                <button type="button" class="btn btn-secondary"
                                                    onclick="cancelEditQty({{ qty.id }})">취소</button>
                                            </div>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <p class="empty-message">등록된 QT가 없습니다.</p>
                        {% endif %}
                    </div>
                </section>

                <!-- News Management Section -->
                <section class="admin-section">
                    <h2 class="section-title">교회소식 관리</h2>

                    <!-- Create News Form -->
                    <div class="admin-card">
                        <h3>새 소식 작성</h3>
                        <form method="POST" action="/admin/news/create" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="title">제목</label>
                                <input type="text" id="title" name="title" required>
                            </div>
                            <div class="form-group">
                                <label for="content">내용</label>
                                <textarea id="content" name="content" rows="6" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="image">이미지 첨부 (선택)</label>
                                <input type="file" id="image" name="image" accept="image/*">
                                <small class="form-hint">JPG, PNG 등의 이미지 파일을 첨부할 수 있습니다.</small>
                            </div>
                            <button type="submit" class="btn btn-primary">소식 등록</button>
                        </form>
                    </div>

                    <!-- News List -->
                    <div class="admin-card">
                        <h3>등록된 소식 목록</h3>
                        <div class="news-list-admin">
                            {% if news_list %}
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>번호</th>
                                        <th>제목</th>
                                        <th>작성자</th>
                                        <th>작성일</th>
                                        <th>조회수</th>
                                        <th>이미지</th>
                                        <th>관리</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for news in news_list %}
                                    <tr>
                                        <td>{{ news.id }}</td>
                                        <td>{{ news.title }}</td>
                                        <td>{{ news.author }}</td>
                                        <td>{{ news.date }}</td>
                                        <td>{{ news.views }}</td>
                                        <td>
                                            {% if news.image_path %}
                                            <span class="badge badge-success">있음</span>
                                            {% else %}
                                            <span class="badge badge-secondary">없음</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <form method="POST" action="/admin/news/delete/{{ news.id }}"
                                                style="display: inline;">
                                                <button type="submit" class="btn-delete"
                                                    onclick="return confirm('정말 삭제하시겠습니까?')">삭제</button>
                                            </form>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            {% else %}
                            <p class="empty-message">등록된 소식이 없습니다.</p>
                            {% endif %}
                        </div>
                    </div>
                </section>

                <!-- Church About Management Section -->
                <section class="admin-section">
                    <h2 class="section-title">교회소개 관리</h2>
                    <div class="admin-card">
                        <form method="POST" action="/admin/about/update">
                            <div class="form-group">
                                <label for="vision-title">비전 제목</label>
                                <input type="text" id="vision-title" name="vision_title"
                                    value="{{ about.vision_title }}" required>
                            </div>

                            <div class="form-group">
                                <label for="vision-content">비전 내용</label>
                                <textarea id="vision-content" name="vision_content" rows="12"
                                    required>{{ about.vision_content }}</textarea>
                            </div>

                            <div class="form-group">
                                <label for="mission-content">5대 사명 내용</label>
                                <textarea id="mission-content" name="mission_content" rows="6"
                                    required>{{ about.mission_content }}</textarea>
                            </div>

                            <div class="form-group">
                                <label for="pastoral-direction">목회 방향 내용</label>
                                <textarea id="pastoral-direction" name="pastoral_direction"
                                    rows="6">{{ about.pastoral_direction }}</textarea>
                            </div>

                            <div class="form-group">
                                <label for="serving-people">섬기는 분들 내용</label>
                                <textarea id="serving-people" name="serving_people"
                                    rows="6">{{ about.serving_people }}</textarea>
                            </div>

                            <button type="submit" class="btn btn-primary">저장</button>
                        </form>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <script src="/static/js/admin.js?v=6"></script>
</body>

</html>